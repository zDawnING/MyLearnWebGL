<html>
  <head>
		<meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1, maximum-scale=1">
	  <!-- <meta name="mobile-web-app-capable" content="yes"> -->

    <!-- <script src="libs/aframe-v0.8.2.js"></script> -->
    <script type="text/javascript" src="libs/webrtc_adpter.js"></script>
		<script src="libs/vconsole.min.js"></script>
		<script type="text/javascript">
			var vConsole = new VConsole();

			var videoElement = document.querySelector('video');
			var videoSelect = document.querySelector('select#videoSource');

			function gotDevices(deviceInfos) {
			  // Handles being called several times to update labels. Preserve values.
			  // var values = selectors.map(function(select) {
			  //   return select.value;
			  // });
			  // selectors.forEach(function(select) {
			  //   while (select.firstChild) {
			  //     select.removeChild(select.firstChild);
			  //   }
			  // });
			  for (var i = 0; i !== deviceInfos.length; ++i) {
			    var deviceInfo = deviceInfos[i];
			    var option = document.createElement('option');
			    option.value = deviceInfo.deviceId;
			    if (deviceInfo.kind === 'videoinput') {
			      option.text = deviceInfo.label || 'camera ' + (videoSelect.length + 1);
			      videoSelect.appendChild(option);
			    } else {
			      console.log('Some other kind of source/device: ', deviceInfo);
			    }
			  }
			  // selectors.forEach(function(select, selectorIndex) {
			  //   if (Array.prototype.slice.call(select.childNodes).some(function(n) {
			  //     return n.value === values[selectorIndex];
			  //   })) {
			  //     select.value = values[selectorIndex];
			  //   }
			  // });
			}

			navigator.mediaDevices.enumerateDevices().then(gotDevices).catch(handleError);

			function gotStream(stream) {
			  window.stream = stream; // make stream available to console
			  videoElement.srcObject = stream;
			  // Refresh button list in case labels have become available
			  return navigator.mediaDevices.enumerateDevices();
			}

			function start() {
			  if (window.stream) {
			    window.stream.getTracks().forEach(function(track) {
			      track.stop();
			    });
			  }
			  var videoSource = videoSelect.value;
			  var constraints = {
			    video: {deviceId: videoSource ? {exact: videoSource} : undefined}
			  };
			  navigator.mediaDevices.getUserMedia(constraints).
			      then(gotStream).then(gotDevices).catch(handleError);
			}

			videoSelect.onchange = start;

			start();

			function handleError(error) {
			  console.log('navigator.getUserMedia error: ', error);
			}

		</script>
  </head>
  <body style='margin : 0px; overflow: hidden;'>
		<video id="video-output" autoplay playsinline></video>
		<select id="videoSource"></select>
  </body>
</html>